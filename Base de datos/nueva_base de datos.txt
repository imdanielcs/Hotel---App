
-- Eliminar tablas previas si existen (para pruebas)
BEGIN
    EXECUTE IMMEDIATE 'DROP TABLE PERSONAL_HOTEL CASCADE CONSTRAINTS';
    EXECUTE IMMEDIATE 'DROP TABLE SERVICIO_TRABAJO CASCADE CONSTRAINTS';
    EXECUTE IMMEDIATE 'DROP TABLE PAGO_TOTAL CASCADE CONSTRAINTS';
    EXECUTE IMMEDIATE 'DROP TABLE PAGO_RESERVA CASCADE CONSTRAINTS';
    EXECUTE IMMEDIATE 'DROP TABLE RESERVA CASCADE CONSTRAINTS';
    EXECUTE IMMEDIATE 'DROP TABLE HABITACION CASCADE CONSTRAINTS';
    EXECUTE IMMEDIATE 'DROP TABLE HOTEL CASCADE CONSTRAINTS';
    EXECUTE IMMEDIATE 'DROP TABLE CLIENTE CASCADE CONSTRAINTS';
    EXECUTE IMMEDIATE 'DROP TABLE CATEGORIA_CLIENTE CASCADE CONSTRAINTS';
EXCEPTION
    WHEN OTHERS THEN
        IF SQLCODE != -942 THEN
            RAISE;
        END IF;
END;
/

-- Crear tablas con columnas de identidad

CREATE TABLE CATEGORIA_CLIENTE (
    id_categoria NUMBER GENERATED BY DEFAULT AS IDENTITY PRIMARY KEY,
    nombre_categoria VARCHAR2(50) NOT NULL
);

CREATE TABLE CLIENTE (
    id_cliente NUMBER GENERATED BY DEFAULT AS IDENTITY PRIMARY KEY,
    nombre_cliente VARCHAR2(50) NOT NULL,
    email_cliente VARCHAR2(100) UNIQUE NOT NULL,
    contrasenia VARCHAR2(50) NOT NULL,
    id_categoria_fk NUMBER NOT NULL,
    FOREIGN KEY (id_categoria_fk) REFERENCES CATEGORIA_CLIENTE(id_categoria)
);

CREATE TABLE HOTEL (
    id_hotel NUMBER GENERATED BY DEFAULT AS IDENTITY PRIMARY KEY,
    nombre_hotel VARCHAR2(100) NOT NULL,
    direccion_hotel VARCHAR2(200) NOT NULL,
    descripcion_hotel VARCHAR2(500),
    telefono_hotel VARCHAR2(15)
);

CREATE TABLE HABITACION (
    id_habitacion NUMBER GENERATED BY DEFAULT AS IDENTITY PRIMARY KEY,
    id_hotel_fk NUMBER NOT NULL,
    numero_habitacion NUMBER NOT NULL,
    tipo_habitacion VARCHAR2(50) NOT NULL,
    precio_habitacion NUMBER NOT NULL,
    FOREIGN KEY (id_hotel_fk) REFERENCES HOTEL(id_hotel)
);

CREATE TABLE RESERVA (
    id_reserva NUMBER GENERATED BY DEFAULT AS IDENTITY PRIMARY KEY,
    id_cliente_fk NUMBER NOT NULL,
    id_habitacion_fk NUMBER NOT NULL,
    fecha_reserva DATE NOT NULL,
    FOREIGN KEY (id_cliente_fk) REFERENCES CLIENTE(id_cliente),
    FOREIGN KEY (id_habitacion_fk) REFERENCES HABITACION(id_habitacion)
);

CREATE TABLE PAGO_RESERVA (
    id_pago_reserva NUMBER GENERATED BY DEFAULT AS IDENTITY PRIMARY KEY,
    id_reserva_fk NUMBER NOT NULL,
    monto_pago NUMBER NOT NULL,
    fecha_pago DATE NOT NULL,
    FOREIGN KEY (id_reserva_fk) REFERENCES RESERVA(id_reserva)
);

CREATE TABLE PAGO_TOTAL (
    id_pago_total NUMBER GENERATED BY DEFAULT AS IDENTITY PRIMARY KEY,
    id_pago_reserva_fk NUMBER NOT NULL,
    monto_total NUMBER NOT NULL,
    fecha_pago DATE NOT NULL,
    FOREIGN KEY (id_pago_reserva_fk) REFERENCES PAGO_RESERVA(id_pago_reserva)
);

CREATE TABLE SERVICIO_TRABAJO (
    id_servicio NUMBER GENERATED BY DEFAULT AS IDENTITY PRIMARY KEY,
    id_hotel_fk NUMBER NOT NULL,
    tipo_servicio VARCHAR2(50) NOT NULL,
    descripcion_servicio VARCHAR2(200),
    FOREIGN KEY (id_hotel_fk) REFERENCES HOTEL(id_hotel)
);

CREATE TABLE PERSONAL_HOTEL (
    id_personal_hotel NUMBER GENERATED BY DEFAULT AS IDENTITY PRIMARY KEY,
    nombre_personal VARCHAR2(50) NOT NULL,
    id_servicio_h_fk NUMBER NOT NULL,
    contrasenia VARCHAR2(50) NOT NULL,
    recuperacion_contrasenia VARCHAR2(50) NOT NULL,
    FOREIGN KEY (id_servicio_h_fk) REFERENCES SERVICIO_TRABAJO(id_servicio)
);

-- Inserciones iniciales

-- Insertar categorías de cliente
INSERT INTO CATEGORIA_CLIENTE (nombre_categoria)
VALUES ('VIP');

INSERT INTO CATEGORIA_CLIENTE (nombre_categoria)
VALUES ('NORMAL');

-- Insertar hotel
INSERT INTO HOTEL (nombre_hotel, direccion_hotel, descripcion_hotel, telefono_hotel) 
VALUES (
    'Hotel Pacific Reef',
    'AV. Alemania 1234',
    'Elegante establecimiento hotelero',
    '2111222'
);

-- Insertar habitaciones
INSERT INTO HABITACION (id_hotel_fk, numero_habitacion, tipo_habitacion, precio_habitacion)
VALUES (
    (SELECT id_hotel FROM HOTEL WHERE nombre_hotel = 'Hotel Pacific Reef'),
    101,
    'Sencilla',
    100.00
);

INSERT INTO HABITACION (id_hotel_fk, numero_habitacion, tipo_habitacion, precio_habitacion)
VALUES (
    (SELECT id_hotel FROM HOTEL WHERE nombre_hotel = 'Hotel Pacific Reef'),
    102,
    'Doble',
    150.00
);

-- Insertar servicios de trabajo
INSERT INTO SERVICIO_TRABAJO (id_hotel_fk, tipo_servicio, descripcion_servicio) 
VALUES (
    (SELECT id_hotel FROM HOTEL WHERE nombre_hotel = 'Hotel Pacific Reef'),
    'RECEPCION',
    'Personal que recibe a los clientes ayudándoles en su ingreso y dando información.'
);

INSERT INTO SERVICIO_TRABAJO (id_hotel_fk, tipo_servicio, descripcion_servicio) 
VALUES (
    (SELECT id_hotel FROM HOTEL WHERE nombre_hotel = 'Hotel Pacific Reef'),
    'LIMPIEZA',
    'Equipo encargado de la limpieza de las habitaciones y áreas comunes del hotel.'
);

-- Insertar cliente
INSERT INTO CLIENTE (nombre_cliente, email_cliente, contrasenia, id_categoria_fk)
VALUES (
    'Dennisse Reveco',
    'de.reveco@duocuc.cl',
    'Deni123',
    (SELECT id_categoria FROM CATEGORIA_CLIENTE WHERE nombre_categoria = 'NORMAL')
);

-- Confirmar las transacciones
COMMIT;
