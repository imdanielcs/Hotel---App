////cree un usuario para la app
CREATE USER HotelApp
IDENTIFIED BY OracleCloud123
DEFAULT TABLESPACE "DATA"
TEMPORARY TABLESPACE "TEMP";

ALTER USER HotelApp QUOTA UNLIMITED ON DATA;

GRANT CREATE SESSION TO HotelApp;
GRANT "RESOURCE" TO HotelApp;

ALTER USER HotelApp DEFAULT ROLE "RESOURCE";
//eliminar secuencias y tablas a modo de pruebas
DROP SEQUENCE SEQ_CLIENTE;
DROP SEQUENCE SEQ_HABITACION;
DROP SEQUENCE SEQ_DETALLE_RESERVA;
DROP SEQUENCE SEQ_RESERVA;
DROP SEQUENCE SEQ_HOTEL;
DROP SEQUENCE SEQ_PAGO_RESERVA;
DROP SEQUENCE SEQ_PAGO_RESERVA_TOTAL;
DROP SEQUENCE SEQ_PERMISOS;
DROP SEQUENCE SEQ_SERVICIO_TRABAJO;
DROP SEQUENCE SEQ_ADMIN;
DROP SEQUENCE SEQ_PERSONAL_HOTEL;
DROP SEQUENCE SEQ_RECUPERAR_CONTRASENIA;

DROP TABLE CATEGORIA_CLIENTE CASCADE CONSTRAINTS;
DROP TABLE CLIENTE CASCADE CONSTRAINTS;
DROP TABLE DETALLE_RESERVA CASCADE CONSTRAINTS;
DROP TABLE ESTADO_CHECK CASCADE CONSTRAINTS;
DROP TABLE CHECK_INT CASCADE CONSTRAINTS;
DROP TABLE CHECK_OUT CASCADE CONSTRAINTS;
DROP TABLE HOTEL CASCADE CONSTRAINTS;
DROP TABLE HABITACION CASCADE CONSTRAINTS;
DROP TABLE TIPO_PAGO CASCADE CONSTRAINTS;
DROP TABLE RESERVA CASCADE CONSTRAINTS;
DROP TABLE PAGO_RESERVA CASCADE CONSTRAINTS;
DROP TABLE PAGO_TOTAL CASCADE CONSTRAINTS;
DROP TABLE PERMISOS CASCADE CONSTRAINTS;
DROP TABLE SERVICIO_TRABAJO CASCADE CONSTRAINTS;
DROP TABLE PERSONAL_ADMIN CASCADE CONSTRAINTS;
DROP TABLE PERSONAL_HOTEL CASCADE CONSTRAINTS;
DROP TABLE RECUPERAR_CONTRASENIA CASCADE CONSTRAINTS;


CREATE SEQUENCE SEQ_CLIENTE
START WITH 1
INCREMENT BY 1;

CREATE SEQUENCE SEQ_RESERVA
START WITH 1
INCREMENT BY 1;

CREATE SEQUENCE SEQ_HABITACION
START WITH 1
INCREMENT BY 1;

CREATE SEQUENCE SEQ_DETALLE_RESERVA
START WITH 1
INCREMENT BY 1;

CREATE SEQUENCE SEQ_HOTEL
START WITH 1
INCREMENT BY 1;

CREATE SEQUENCE SEQ_PAGO_RESERVA
START WITH 1
INCREMENT BY 1;

CREATE SEQUENCE SEQ_PAGO_RESERVA_TOTAL
START WITH 1
INCREMENT BY 1;

CREATE SEQUENCE SEQ_PERMISOS
START WITH 1
INCREMENT BY 1;

CREATE SEQUENCE SEQ_SERVICIO_TRABAJO
START WITH 1
INCREMENT BY 1;

CREATE SEQUENCE SEQ_ADMIN
START WITH 1
INCREMENT BY 1;

CREATE SEQUENCE SEQ_PERSONAL_HOTEL
START WITH 1
INCREMENT BY 1;

CREATE SEQUENCE SEQ_RECUPERAR_CONTRASENIA
START WITH 1
INCREMENT BY 1;


//creaci√≥n de tablas
CREATE TABLE CATEGORIA_CLIENTE(
 id_categoria NUMBER(2) NOT NULL,
 descripcion_cat VARCHAR2(20) NOT NULL,
 CONSTRAINT PK_ID_CATEGORIA PRIMARY KEY (id_categoria)
);  

CREATE TABLE ESTADO_CHECK(
 id_estado_check NUMBER(2) NOT NULL,
 descripcion_check VARCHAR2(6) NOT NULL,
 CONSTRAINT PK_ID_CHECK PRIMARY KEY (id_estado_check)
);  

CREATE TABLE CLIENTE(
 id_cliente NUMBER DEFAULT SEQ_CLIENTE.NEXTVAL NOT NULL,
 nombre_cliente VARCHAR2(25) NOT NULL,
 apellido_cliente VARCHAR2(25) NOT NULL,
 correo_cliente VARCHAR2(50) NOT NULL,
 telefono_cliente VARCHAR2(25) NOT NULL,
 id_categoria_fk NUMBER NOT NULL,
 id_contrasenia_fk NUMBER NOT NULL,
 CONSTRAINT PK_CLIENTE PRIMARY KEY (id_cliente)
);


CREATE TABLE RECUPERAR_CONTRASENIA(
 id_contrasenia NUMBER DEFAULT SEQ_RECUPERAR_CONTRASENIA.NEXTVAL NOT NULL,
 dato_recuperacion VARCHAR2(50) NOT NULL,
 contrasenia VARCHAR2(50) NOT NULL,
 CONSTRAINT PK_RECUPERAR_CONTRASENIA PRIMARY KEY (id_contrasenia)
);


CREATE TABLE CHECK_INT(
 id_check_int NUMBER(2) NOT NULL,
 id_cliente_fk NUMBER NOT NULL,
 id_estado_check_fk NUMBER NOT NULL,
 hora_entrada TIMESTAMP NOT NULL,
 fecha_entrada DATE NOT NULL,
 id_reserva_fk NUMBER NOT NULL,
 CONSTRAINT PK_ID_CHECK_INT PRIMARY KEY (id_check_int)
); 

CREATE TABLE CHECK_OUT(
 id_check_out NUMBER(2) NOT NULL,
 id_cliente_fk NUMBER NOT NULL,
 id_estado_check_fk NUMBER NOT NULL,
 hora_salida TIMESTAMP NOT NULL,
 fecha_salida DATE NOT NULL,
 id_reserva_fk NUMBER NOT NULL,
 CONSTRAINT PK_ID_CHECK_OUT PRIMARY KEY (id_check_out)
); 

CREATE TABLE HOTEL(
 id_hotel NUMBER DEFAULT SEQ_HOTEL.NEXTVAL NOT NULL,
 nombre_hotel VARCHAR2(25) NOT NULL,
 direccion_hotel VARCHAR2(25) NOT NULL,
 descripcion_hotel VARCHAR2(100) NOT NULL,
 telefono_hotel VARCHAR2(25) NOT NULL,
CONSTRAINT PK_HOTEL PRIMARY KEY (id_hotel)
);

CREATE TABLE HABITACION(
 id_habitacion NUMBER DEFAULT SEQ_HABITACION.NEXTVAL NOT NULL,
 tipo_habitacion VARCHAR2(40) NOT NULL,
 capacidad NUMBER(3) NOT NULL,
 precio_dia NUMBER(12) NOT NULL,
 descripcion_habitacion VARCHAR2(100) NOT NULL,
 num_habitacion NUMBER(5) NOT NULL,
 descrip_disponibilidad CHAR(1),
 id_hotel_fk NUMBER NOT NULL,
 CONSTRAINT PK_HABITACION PRIMARY KEY (id_habitacion)
);

CREATE TABLE DETALLE_RESERVA(
 id_detalle_reserva NUMBER DEFAULT SEQ_DETALLE_RESERVA.NEXTVAL NOT NULL,
 id_habitacion_fk NUMBER NOT NULL,
 fecha_entrada DATE NOT NULL,
 fecha_salida DATE NOT NULL,
 hora_entrada TIMESTAMP NOT NULL,
 hora_salida TIMESTAMP NOT NULL,
 CONSTRAINT PK_DETALLE_RESERVA PRIMARY KEY (id_detalle_reserva)
);

CREATE TABLE TIPO_PAGO(
 id_tipo_pago NUMBER(2) NOT NULL,
 descripcion_pago VARCHAR2(25) NOT NULL,
 valor_tasa_cambio NUMBER(15, 2) NOT NULL,
 CONSTRAINT PK_TIPO_PAGO PRIMARY KEY (id_tipo_pago)
);

CREATE TABLE RESERVA(
 id_reserva NUMBER DEFAULT SEQ_RESERVA.NEXTVAL NOT NULL,
 id_habitacion_fk NUMBER NOT NULL,
 id_detalle_reserva_fk NUMBER NOT NULL,
 id_reserva_cliente_fk NUMBER NOT NULL,
 estado_Reserva VARCHAR2(25) NOT NULL,
 id_pago_reserva_fk NUMBER,
 id_pago_reserva_total_fk NUMBER,
 CONSTRAINT PK_RESERVA PRIMARY KEY (id_reserva)
);

CREATE TABLE PAGO_RESERVA(
 id_pago_reserva NUMBER DEFAULT SEQ_PAGO_RESERVA.NEXTVAL NOT NULL,
 id_boleta VARCHAR2(25) NOT NULL,
 id_tipo_pago_fk NUMBER(2) NOT NULL,
 monto NUMBER(15, 2) NOT NULL,
 fecha_hora_pago TIMESTAMP NOT NULL,
 iva NUMBER(15, 10) NOT NULL,
 CONSTRAINT PK_PAGO_RESERVA PRIMARY KEY (id_pago_reserva)
);

CREATE TABLE PAGO_TOTAL(
 id_pago_reserva_total NUMBER DEFAULT SEQ_PAGO_RESERVA_TOTAL.NEXTVAL NOT NULL,
 id_boleta VARCHAR2(25) NOT NULL,
 id_tipo_pago_fk NUMBER(2) NOT NULL,
 monto NUMBER(15, 2) NOT NULL,
 fecha_hora_pago TIMESTAMP NOT NULL,
 iva NUMBER(10, 2) NOT NULL,
 CONSTRAINT PK_PAGO_TOTAL PRIMARY KEY (id_pago_reserva_total)
);

CREATE TABLE PERMISOS(
 id_permisos NUMBER DEFAULT SEQ_PERMISOS.NEXTVAL NOT NULL,
 tipo_permiso VARCHAR2(25) NOT NULL,
 descripcion_per VARCHAR2(25) NOT NULL,
 CONSTRAINT PK_PERMISOS PRIMARY KEY (id_permisos)
);

CREATE TABLE SERVICIO_TRABAJO(
 id_servicio NUMBER DEFAULT SEQ_SERVICIO_TRABAJO.NEXTVAL NOT NULL,
 id_hotel_fk NUMBER NOT NULL,
 tipo_servicio VARCHAR2(25) NOT NULL,
 descripcion_servicio VARCHAR2(100) NOT NULL,
 CONSTRAINT PK_SERVICIO_TRABAJO PRIMARY KEY (id_servicio)
);

CREATE TABLE PERSONAL_ADMIN(
 id_admin NUMBER DEFAULT SEQ_ADMIN.NEXTVAL NOT NULL,
 nombre_admin VARCHAR2(25) NOT NULL,
 apellido_admin VARCHAR2(25) NOT NULL,
 correo_admin VARCHAR2(50) NOT NULL,
 telefono_admin VARCHAR2(25) NOT NULL,
 id_permiso_fk NUMBER NOT NULL,
 id_servicio_fk NUMBER NOT NULL,
 id_contrasenia_admin_fk NUMBER NOT NULL,
 CONSTRAINT PK_PERSONAL_ADMIN PRIMARY KEY (id_admin)
);

CREATE TABLE PERSONAL_HOTEL(
 id_personal_hotel NUMBER DEFAULT SEQ_PERSONAL_HOTEL.NEXTVAL NOT NULL,
 nombre_personal_h VARCHAR2(25) NOT NULL,
 apellido_personal_h VARCHAR2(25) NOT NULL,
 correo_personal_h VARCHAR2(50) NOT NULL,
 telefono_personal_h VARCHAR2(25) NOT NULL,
 id_permiso_h_fk NUMBER NOT NULL,
 id_servicio_h_fk NUMBER NOT NULL,
 id_contrasenia_perso_fk NUMBER NOT NULL,
 CONSTRAINT PK_PERSONAL_HOTEL PRIMARY KEY (id_personal_hotel)
);  

ALTER TABLE CLIENTE 
ADD CONSTRAINT FK_CATEGORIA_CLIENTE FOREIGN KEY (id_categoria_fk)
  REFERENCES CATEGORIA_CLIENTE(id_categoria);

ALTER TABLE CLIENTE 
ADD CONSTRAINT FK_CONTRASENIA_CLIENTE FOREIGN KEY (id_contrasenia_fk)
  REFERENCES RECUPERAR_CONTRASENIA(id_contrasenia);

ALTER TABLE CHECK_INT 
ADD CONSTRAINT FK_CHECKINT_CLIENTE FOREIGN KEY (id_cliente_fk)
  REFERENCES CLIENTE(id_cliente);

ALTER TABLE CHECK_OUT
ADD CONSTRAINT FK_CHECKOUT_CLIENTE_OUT FOREIGN KEY (id_cliente_fk)
  REFERENCES CLIENTE(id_cliente);

ALTER TABLE CHECK_INT 
ADD CONSTRAINT FK_ESTADO_CHECKINT FOREIGN KEY (id_estado_check_fk)
  REFERENCES ESTADO_CHECK(id_estado_check);

ALTER TABLE CHECK_OUT
ADD CONSTRAINT FK_ESTADO_CHECKOUT FOREIGN KEY (id_estado_check_fk)
  REFERENCES ESTADO_CHECK(id_estado_check);

ALTER TABLE CHECK_INT 
ADD CONSTRAINT FK_RESERVA_CHECKINT FOREIGN KEY (id_reserva_fk)
  REFERENCES RESERVA(id_reserva);

ALTER TABLE CHECK_OUT
ADD CONSTRAINT FK_RESERVA_CHECKOUT FOREIGN KEY (id_reserva_fk)
  REFERENCES RESERVA(id_reserva);

ALTER TABLE HABITACION
ADD CONSTRAINT FK_HOTEL_HABITACION FOREIGN KEY (id_hotel_fk)
  REFERENCES HOTEL(id_hotel);

ALTER TABLE DETALLE_RESERVA
ADD CONSTRAINT FK_DETALLE_RES_HABITACION FOREIGN KEY (id_habitacion_fk)
  REFERENCES HABITACION(id_habitacion);

ALTER TABLE RESERVA
ADD CONSTRAINT FK_RES_HABITACION FOREIGN KEY (id_habitacion_fk)
  REFERENCES HABITACION(id_habitacion);

ALTER TABLE PAGO_RESERVA
ADD CONSTRAINT FK_TIPO_PAGO_RESERVA FOREIGN KEY (id_tipo_pago_fk)
  REFERENCES TIPO_PAGO(id_tipo_pago);

ALTER TABLE PAGO_TOTAL
ADD CONSTRAINT FK_TIPO_PAGO_TOTAL FOREIGN KEY (id_tipo_pago_fk)
  REFERENCES TIPO_PAGO(id_tipo_pago);

ALTER TABLE RESERVA
ADD CONSTRAINT FK_DETALLE_RESERVA FOREIGN KEY (id_detalle_reserva_fk)
  REFERENCES DETALLE_RESERVA(id_detalle_reserva);

ALTER TABLE RESERVA
ADD CONSTRAINT FK_DETALLE_RESERVA_CLIENTE FOREIGN KEY (id_reserva_cliente_fk)
  REFERENCES CLIENTE(id_cliente);

ALTER TABLE RESERVA
ADD CONSTRAINT FK_PAGO_RESERVA FOREIGN KEY (id_pago_reserva_fk)
  REFERENCES PAGO_RESERVA(id_pago_reserva);

ALTER TABLE RESERVA
ADD CONSTRAINT FK_PAGO_RESERVA_TOTAL FOREIGN KEY (id_pago_reserva_total_fk)
  REFERENCES PAGO_TOTAL(id_pago_reserva_total);

ALTER TABLE SERVICIO_TRABAJO
ADD CONSTRAINT FK_HOTEL FOREIGN KEY (id_hotel_fk)
  REFERENCES HOTEL(id_hotel);

ALTER TABLE PERSONAL_ADMIN
ADD CONSTRAINT FK_PERMISOS FOREIGN KEY (id_permiso_fk)
  REFERENCES PERMISOS(id_permisos);
 
ALTER TABLE PERSONAL_ADMIN
ADD CONSTRAINT FK_SERVICIOS_ADMIN FOREIGN KEY (id_servicio_fk)
  REFERENCES SERVICIO_TRABAJO(id_servicio);

ALTER TABLE PERSONAL_HOTEL
ADD CONSTRAINT FK_PERMISOS_PERSONAL FOREIGN KEY (id_permiso_h_fk)
  REFERENCES PERMISOS(id_permisos);

ALTER TABLE PERSONAL_HOTEL
ADD CONSTRAINT FK_SERVICIOS_PERSONAL FOREIGN KEY (id_servicio_h_fk)
  REFERENCES SERVICIO_TRABAJO(id_servicio);

ALTER TABLE PERSONAL_ADMIN
ADD CONSTRAINT FK_CONTRASENIA_ADMIN FOREIGN KEY (id_contrasenia_admin_fk)
  REFERENCES RECUPERAR_CONTRASENIA(id_contrasenia);


ALTER TABLE PERSONAL_HOTEL
ADD CONSTRAINT FK_CONTRASENIA_PERSONAL FOREIGN KEY (id_contrasenia_perso_fk)
  REFERENCES RECUPERAR_CONTRASENIA(id_contrasenia);

